<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!-- Properties -->
    <property name="LOG_LEVEL" value="${YOUTOO_LOG_LEVEL:-${env:YOUTOO_LOG_LEVEL:-DEBUG}}" />
    <property name="APPLICATION_NAME" value="${YOUTOO_APPLICATION_NAME}" />

    <!-- Console Appender -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <withJansi>true</withJansi>
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <jsonGeneratorDecorator class="com.youtoo.logging.SensitiveMaskingPatternLayout" />
            <jsonGeneratorDecorator class="net.logstash.logback.mask.MaskingJsonGeneratorDecorator">
                <value>\"(\w*(?i)card\w*)\"\s*:\s*\"([^\"]*)\"</value><!-- Any property with the word card -->
                <value>\"(\w*(?i)address\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)email\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)password\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)token\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)phone\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)passport\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)expiryDate\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)cvv\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)security\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)txnFlow\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)cvc\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)cvv\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)firstName\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>\"(\w*(?i)lastName\w*)\"\s*:\s*\"([^\"]*)\"</value>
                <value>(\d+\.\d+\.\d+\.\d+)</value> <!-- Ip address IPv4-->
                <value>(\w+@\w+\.\w+)</value> <!-- Email pattern -->
            </jsonGeneratorDecorator>
            <providers>
                <timestamp>
                    <fieldName>Timestamp/UTC</fieldName>
                    <timeZone>UTC</timeZone>
                </timestamp>
                <logLevel>
                    <fieldName>Level</fieldName>
                </logLevel>
                <threadName>
                    <fieldName>Thread</fieldName>
                </threadName>
                <contextName>
                    <fieldName>ServiceName</fieldName>
                </contextName>
                <pattern>
                    <!-- The pattern that defines what to include -->
                    <pattern>
                        {
                          "ServiceVersion": "${APPLICATION_NAME}",
                          "ServiceHostName": "${hostname}",
                          "PID": "${PID:-}"
                        }
                    </pattern>
                </pattern>
                <mdc />
                <!-- <arguments> -->
                <!--     <includeNonStructuredArguments>true</includeNonStructuredArguments> -->
                <!-- </arguments> -->
                <loggerName>
                    <fieldName>Logger</fieldName>
                </loggerName>
                <callerData>
                    <!-- <classFieldName>Class</classFieldName> -->
                    <!-- <methodFieldName>Method</methodFieldName> -->
                    <fileFieldName>File</fileFieldName>
                    <lineFieldName>Line</lineFieldName>
                </callerData>
                <message>
                    <fieldName>Message</fieldName>
                </message>
                <throwableClassName>
                    <fieldName>ExceptionClass</fieldName>
                </throwableClassName>
                <stackTrace>
                    <fieldName>StackTrace</fieldName>
                    <!-- maxLength - limit the length of the stack trace -->
                    <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
                        <maxDepthPerThrowable>200</maxDepthPerThrowable>
                        <maxLength>5000</maxLength>
                        <rootCauseFirst>true</rootCauseFirst>
                    </throwableConverter>
                </stackTrace>
            </providers>
        </encoder>
    </appender>
</configuration>
